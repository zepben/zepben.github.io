<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.18.0 plugin-docs plugin-id-default docs-doc-id-phase-consistency">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Phase Consistency Processor | Migrator SDK (JVM)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zepben.github.io/evolve/docs/migrator-sdk/0.18.0/phase-consistency"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:project" content="migrator-sdk"><meta data-rh="true" name="docusaurus_version" content="0.18.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.18.0"><meta data-rh="true" name="docsearch:version" content="0.18.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.18.0"><meta data-rh="true" property="og:title" content="Phase Consistency Processor | Migrator SDK (JVM)"><meta data-rh="true" name="description" content="The phase consistency module is used to repair phase inconsistencies in a NetworkService."><meta data-rh="true" property="og:description" content="The phase consistency module is used to repair phase inconsistencies in a NetworkService."><link data-rh="true" rel="icon" href="/evolve/docs/migrator-sdk/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zepben.github.io/evolve/docs/migrator-sdk/0.18.0/phase-consistency"><link data-rh="true" rel="alternate" href="https://zepben.github.io/evolve/docs/migrator-sdk/0.18.0/phase-consistency" hreflang="en"><link data-rh="true" rel="alternate" href="https://zepben.github.io/evolve/docs/migrator-sdk/0.18.0/phase-consistency" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3K6D3DR52K-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JG9JB2RSST"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JG9JB2RSST",{})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Migrator SDK (JVM)" href="/evolve/docs/migrator-sdk/opensearch.xml"><link rel="stylesheet" href="/evolve/docs/migrator-sdk/assets/css/styles.d69042d4.css">
<link rel="preload" href="/evolve/docs/migrator-sdk/assets/js/runtime~main.f9fe5224.js" as="script">
<link rel="preload" href="/evolve/docs/migrator-sdk/assets/js/main.d9686c9e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.zepben.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/evolve/docs/migrator-sdk/img/logo.svg" alt="Zepben" class="themedImage_ToTc themedImage--light_HNdA"><img src="/evolve/docs/migrator-sdk/img/logo-dark.svg" alt="Zepben" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a href="https://zepben.github.io/evolve/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Evolve</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/evolve/docs/migrator-sdk/">Docs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/evolve/docs/migrator-sdk/release-notes">Release Notes</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/evolve/docs/migrator-sdk/0.18.0/">0.18.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/next/phase-consistency">Next</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.23.0/phase-consistency">0.23.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.22.0/phase-consistency">0.22.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.21.2/phase-consistency">0.21.2</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.21.1/phase-consistency">0.21.1</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.21.0/phase-consistency">0.21.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.20.0/phase-consistency">0.20.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.19.0/phase-consistency">0.19.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/evolve/docs/migrator-sdk/0.18.0/phase-consistency">0.18.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.17.0/phase-consistency">0.17.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.16.0/phase-consistency">0.16.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.15.0/phase-consistency">0.15.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.14.0/phase-consistency">0.14.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.13.1/phase-consistency">0.13.1</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.13.0/phase-consistency">0.13.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.12.0/phase-consistency">0.12.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.11.0/phase-consistency">0.11.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.10.0/phase-consistency">0.10.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.9.0/phase-consistency">0.9.0</a></li><li><a class="dropdown__link" href="/evolve/docs/migrator-sdk/0.8.0/phase-consistency">0.8.0</a></li></ul></div><a href="https://github.com/zepben/migrator-sdk/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/evolve/docs/migrator-sdk/0.18.0/">Migrator SDK Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/evolve/docs/migrator-sdk/0.18.0/phase-consistency">Phase Consistency Processor</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Migrator SDK (JVM)<!-- --> <b>0.18.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/evolve/docs/migrator-sdk/0.23.0/phase-consistency">latest version</a></b> (<!-- -->0.23.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/evolve/docs/migrator-sdk/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Phase Consistency Processor</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.18.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Phase Consistency Processor</h1></header><p>The phase consistency module is used to repair phase inconsistencies in a <code>NetworkService</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick Start<a href="#quick-start" class="hash-link" aria-label="Direct link to Quick Start" title="Direct link to Quick Start">​</a></h2><p>The simplest, and most common use of this module is via the <code>PhaseConsistencyProcessor</code> class and the <code>makeConsistent</code> function, which takes the following
parameters:</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr><tr><td>getTransformerPhaseType</td><td>Callback to get the <code>TransformerPhaseType</code> for a transformer ID from the source data.</td></tr><tr><td>getFileId</td><td>Callback to get the source file associated with an ID.</td></tr></tbody></table><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Kotlin</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> logger </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> LoggerFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLogger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">javaClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> issues </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">PhaseIssues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> lvThreshold </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> phaseConsistencyProcessor </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">PhaseConsistencyProcessor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">issues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lvThreshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">phaseConsistencyProcessor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">makeConsistent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    networkService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    getTransformerPhaseType </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> sourceId </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">mapToTransformerPhaseType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sourceData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">sourceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">attributes</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;Phases&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    getFileId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> sourceId </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sourceData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">sourceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fileId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>The <code>makeConsistent</code> function will update the phases for the specified <code>networkService</code> to ensure they are consistent, keeping as much of the source phase
information as possible. To do this, the following processes will be run:</p><ol><li>Set all service equipment with no known phases to single-phase.</li><li>Set transformer phases from known 3-phase transformers.</li><li>Extend phases onto missing downstream.</li><li>Extend phases onto missing upstream.</li><li>Remove known non-3-phase from the network, keeping those phases as hints for later.</li><li>Set transformer phases from known single-phase and SWER transformers.</li><li>Repair the phases of any split 3-phase.</li><li>Extend phases onto missing downstream.</li><li>Infer transformer phases from unknown transformer phase types.</li><li>Extend phases onto missing downstream again to allow for transformer phases from step 8.</li><li>Extend phases onto missing upstream.</li><li>Replace invalid phases downstream.</li><li>Replace invalid phases upstream from transformers.</li><li>Replace invalid phases in loops.</li><li>Restore energy consumer phases.</li><li>Update XY phase codes to known phases using the hints where possible.</li><li>Replace invalid phases upstream from transformer again to allow for replaced XY from step 14.</li><li>Make all remaining network with missing phases 3-phase.</li></ol><p>In each instance where phases are spread, priority will be given to the phases emanating from transformers, then 3-phase over 2-phase over single-phase.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Known Edge Case</div><div class="admonitionContent_S0QG"><p>There is a known edge case that is not supported by the above processing. If you have a section of 3-phase backbone with an incorrect SWER segment above a split
3-phase regulator (each phase going through a separate transformer), the results of the consistency processing will be inaccurate/broken. In this case you will
need to either fix the SWER segment in the source system and generate a new extract, or update it manually in the extracted source data.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="repair-the-phases-of-any-split-3-phase">Repair the phases of any split 3-phase<a href="#repair-the-phases-of-any-split-3-phase" class="hash-link" aria-label="Direct link to Repair the phases of any split 3-phase" title="Direct link to Repair the phases of any split 3-phase">​</a></h2><p>When a section of 3-phase backbone is split into three separate cables for an underground span in a source system that does not provide the actual phases of the
cables (just the number of cores), you end up with all the cables being marked as phase <code>X</code>. If you do not repair this, you will end up with each of the cables
being given the same phase, which can break the feeder downstream in strange ways (far from the site of the error) due to conflicting information from the
transformers.</p><p>In order to fix this, we detect termination points where a 3-phase cable is split into three individual phase cables that later join back together, and replace
these <code>X</code> phase cables with one each of <code>A</code>, <code>B</code> and <code>C</code>. Since some source systems do not need to be electrically correct (e.g. some GIS systems) we also
detect where a single span of single core cable is attached between the 3-phase and the split, which has been observed to make diagrams &quot;prettier&quot;.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sub-processors">Sub-processors<a href="#sub-processors" class="hash-link" aria-label="Direct link to Sub-processors" title="Direct link to Sub-processors">​</a></h2><p>The following sub-processors are used to make a <code>NetworkService</code> consistent. Each of these can be used separately to perform their actions if desired.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="droppedphaseloopfixer">DroppedPhaseLoopFixer<a href="#droppedphaseloopfixer" class="hash-link" aria-label="Direct link to DroppedPhaseLoopFixer" title="Direct link to DroppedPhaseLoopFixer">​</a></h3><p>A class that can be used to fix the phasing of loops that contain segments surrounded by segments with fewer phases, resulting in dropped phases.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix"><code>fix</code><a href="#fix" class="hash-link" aria-label="Direct link to fix" title="Direct link to fix">​</a></h4><p>Fix 3-phase loop segments that are surrounded by single-phase segments. If there is a 3-phase transformer in the loop, or there
is another 3-phase segment in the loop (including the incoming connection to the loop), create a 3-phase path between them, otherwise, remove the island
3-phase segment and any downstream 3-phase.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="incompatiblephasefixer">IncompatiblePhaseFixer<a href="#incompatiblephasefixer" class="hash-link" aria-label="Direct link to IncompatiblePhaseFixer" title="Direct link to IncompatiblePhaseFixer">​</a></h3><p>A class for fixing incompatible phase combinations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fixdownstream"><code>fixDownstream</code><a href="#fixdownstream" class="hash-link" aria-label="Direct link to fixdownstream" title="Direct link to fixdownstream">​</a></h4><p>Fix any phase incompatibilities in a downstream direction. This will replace the incompatible downstream phases with the valid upstream phases.
Incompatible phases are any phases that are not a subset of the upstream phases, or an unknown representation of those phases. To do this,
phases will be spread in the following order:</p><ol><li>From any transformer not in a loop.</li><li>From the low voltage side of any transformer in a loop.</li><li>From any non-transformer not in a loop.</li><li>From any non-transformer in a loop.</li></ol><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fixtransformerupstreams"><code>fixTransformerUpstreams</code><a href="#fixtransformerupstreams" class="hash-link" aria-label="Direct link to fixtransformerupstreams" title="Direct link to fixtransformerupstreams">​</a></h4><p>Fix any paths to transformers that have phase incompatibilities in an upstream direction. This will replace the incompatible upstream phases with the
valid transformer phases. Incompatible phases are any phases that are not a superset of the transformer phases, or an unknown representation of those
phases.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="phaseextender">PhaseExtender<a href="#phaseextender" class="hash-link" aria-label="Direct link to PhaseExtender" title="Direct link to PhaseExtender">​</a></h3><p>A class for extending known phases onto terminals with missing phases. This is done in a downstream direction first, giving priority to known transformer
phases, then 3-phase over single-phase.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="extenddownstream"><code>extendDownstream</code><a href="#extenddownstream" class="hash-link" aria-label="Direct link to extenddownstream" title="Direct link to extenddownstream">​</a></h4><p>Extend phases downstream onto terminals with missing phases for the specified <code>networkService</code>. Priority will be given to transformer phases, then following
the order defined by <code>PhasePrecedence.PRECEDENCE</code>.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="extendupstream"><code>extendUpstream</code><a href="#extendupstream" class="hash-link" aria-label="Direct link to extendupstream" title="Direct link to extendupstream">​</a></h4><p>Extend known phases upstream onto terminals with unknown phases for the specified <code>networkService</code>. Priority will be given to transformer phases, then
following the order defined by <code>PhasePrecedence.PRECEDENCE</code>.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="phaseissues">PhaseIssues<a href="#phaseissues" class="hash-link" aria-label="Direct link to PhaseIssues" title="Direct link to PhaseIssues">​</a></h3><p>A collection of issue trackers for tracking problems corrected by the phase consistency processing.</p><table><thead><tr><th>Tracker</th><th>Purpose</th></tr></thead><tbody><tr><td>inconsistentPhases</td><td>Tracks items where the phases in the EWB database do not match the phases in the source data.</td></tr><tr><td>txMultipleUpstreamFeeds</td><td>Tracks transformers where phase consistency could not be processed due to having multiple paths to a feeder head, so direction could not be determines.</td></tr><tr><td>txWithConflictingSwer</td><td>Tracks transformers with conflicts between SWER phases and voltages.</td></tr><tr><td>txWithMissingSourcePhases</td><td>Tracks transformers where there was no phase information available in the source data, and the phases had to be inferred.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="phaseprecedence">PhasePrecedence<a href="#phaseprecedence" class="hash-link" aria-label="Direct link to PhasePrecedence" title="Direct link to PhasePrecedence">​</a></h3><p>Defines the order of precedence that phases will be processed, and which phases belong to each category.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transformerphaseprocessor">TransformerPhaseProcessor<a href="#transformerphaseprocessor" class="hash-link" aria-label="Direct link to TransformerPhaseProcessor" title="Direct link to TransformerPhaseProcessor">​</a></h3><p>A class for processing <code>PowerTransformer</code> phases.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="process"><code>process</code><a href="#process" class="hash-link" aria-label="Direct link to process" title="Direct link to process">​</a></h4><p>Validate that <code>PowerTransformer</code> phases make sense, and update them if they don&#x27;t. Transformers with unknown source phases (or SWER without SWER voltage)
will be stored for later processing via <code>inferUnknown</code>.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr><tr><td>getTransformerType</td><td>A callback to get the <code>TransformerPhaseType</code> for the specified ID. Returning <code>null</code> will be treated the same as <code>TransformerPhaseType.UNKNOWN</code>.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="inferunknown"><code>inferUnknown</code><a href="#inferunknown" class="hash-link" aria-label="Direct link to inferunknown" title="Direct link to inferunknown">​</a></h4><p>Validate that the phases of <code>powerTransformer</code> with unknown type make sense, and update them if they don&#x27;t.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>powerTransformer</td><td>The <code>PowerTransformer</code> to process.</td></tr><tr><td>up</td><td>The upstream terminal of <code>powerTransformer</code>.</td></tr><tr><td>down</td><td>The downstream terminals of <code>powerTransformer</code>.</td></tr><tr><td>onTypeDetermined</td><td>Consumer that is used to perform processing (e.g. logging) when the type of the <code>powerTransformer</code> is determined.</td></tr></tbody></table><p>Returns a list of terminals that have been updated.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="processswer"><code>processSwer</code><a href="#processswer" class="hash-link" aria-label="Direct link to processswer" title="Direct link to processswer">​</a></h4><p>Validate that the phases of SWER <code>powerTransformer</code> make sense, and update them if they don&#x27;t.</p><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>powerTransformer</td><td>The <code>PowerTransformer</code> to process.</td></tr><tr><td>up</td><td>The upstream terminal of <code>powerTransformer</code>.</td></tr><tr><td>down</td><td>The downstream terminals of <code>powerTransformer</code>.</td></tr></tbody></table><p>Return a list of terminals that have been updated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transformerphasetype">TransformerPhaseType<a href="#transformerphasetype" class="hash-link" aria-label="Direct link to TransformerPhaseType" title="Direct link to TransformerPhaseType">​</a></h3><p>An enumeration of the phase type for a <code>PowerTransformer</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="xyphaseprocessor">XyPhaseProcessor<a href="#xyphaseprocessor" class="hash-link" aria-label="Direct link to XyPhaseProcessor" title="Direct link to XyPhaseProcessor">​</a></h3><p>A class that can be used to replace XY phases with primary phases. Takes an optional phase allocation algorithm used to determine which candidate phase to use
when an exact match could not be found. Takes two parameters, the terminal being processed and the candidate phases.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Ignoring Candidates</div><div class="admonitionContent_S0QG"><p>There is no validation of the returned phase code. If you return a phase that is not in the candidates, you will introduce a phase inconsistency.</p></div></div><p>The default phase allocation algorithm chooses a random candidate based on the hash of the terminals conducting equipments mRID. This does a reasonable job of
spreading the phases while also being repeatable, giving stability to re-runs of an extract.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Precondition</div><div class="admonitionContent_S0QG"><p>All terminals in the network service that are connected to XY spans must have phases assigned prior to calling this function for it to work correctly.
The <code>PhaseExtender</code> class can be used to ensure this precondition is met.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="assignprimaryphases"><code>assignPrimaryPhases</code><a href="#assignprimaryphases" class="hash-link" aria-label="Direct link to assignprimaryphases" title="Direct link to assignprimaryphases">​</a></h4><p>Assign primary phases to all XY terminals. This is done with the following priority:</p><ol><li><p>Continue any matching known phasing:</p><p>This will continue AB, BC or AC over XY, or A, B or C over X, maintaining neutrals.</p></li><li><p>Back-fill from any subsets of known phases.</p><p>This will back-fill AB or AC over XY is there is a downstream A, BC or AB from B and AC or BC from C, maintaining neutrals. Which phase is used
is determined by the phase allocation algorithm.</p></li><li><p>Allocate a valid subset phase using the phase allocation algorithm.</p><p>This will allocate one of the following:</p><ul><li>AB, BC or AC for an XY below ABC</li><li>A, B or C for an X below ABC</li><li>A or B for an X below AB</li><li>B or C for an X below BC</li><li>C or A for an X below AC</li></ul></li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Transformer Phases</div><div class="admonitionContent_S0QG"><p>While applying these rules, any transformers will be processed with the following translations where necessary:</p><ul><li>HV to LV:<ul><li>ABC &lt;-&gt; ABCN</li><li>AB &lt;-&gt; AN</li><li>BC &lt;-&gt; BN</li><li>AC &lt;-&gt; CN</li></ul></li><li>HV to SWER:<ul><li>AB &lt;-&gt; A</li><li>BC &lt;-&gt; B</li><li>AC &lt;-&gt; C</li></ul></li><li>SWER to LV<ul><li>A &lt;-&gt; AN</li><li>B &lt;-&gt; BN</li><li>C &lt;-&gt; CN</li></ul></li></ul></div></div><table><thead><tr><th>Parameter</th><th>Purpose</th></tr></thead><tbody><tr><td>networkService</td><td>The network service to process.</td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/evolve/docs/migrator-sdk/0.18.0/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Migrator SDK Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick Start</a></li><li><a href="#repair-the-phases-of-any-split-3-phase" class="table-of-contents__link toc-highlight">Repair the phases of any split 3-phase</a></li><li><a href="#sub-processors" class="table-of-contents__link toc-highlight">Sub-processors</a><ul><li><a href="#droppedphaseloopfixer" class="table-of-contents__link toc-highlight">DroppedPhaseLoopFixer</a></li><li><a href="#incompatiblephasefixer" class="table-of-contents__link toc-highlight">IncompatiblePhaseFixer</a></li><li><a href="#phaseextender" class="table-of-contents__link toc-highlight">PhaseExtender</a></li><li><a href="#phaseissues" class="table-of-contents__link toc-highlight">PhaseIssues</a></li><li><a href="#phaseprecedence" class="table-of-contents__link toc-highlight">PhasePrecedence</a></li><li><a href="#transformerphaseprocessor" class="table-of-contents__link toc-highlight">TransformerPhaseProcessor</a></li><li><a href="#transformerphasetype" class="table-of-contents__link toc-highlight">TransformerPhaseType</a></li><li><a href="#xyphaseprocessor" class="table-of-contents__link toc-highlight">XyPhaseProcessor</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Zeppelin Bend Pty. Ltd.</div></div></div></footer></div>
<script src="/evolve/docs/migrator-sdk/assets/js/runtime~main.f9fe5224.js"></script>
<script src="/evolve/docs/migrator-sdk/assets/js/main.d9686c9e.js"></script>
</body>
</html>