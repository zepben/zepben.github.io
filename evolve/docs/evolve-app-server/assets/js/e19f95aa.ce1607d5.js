"use strict";(self.webpackChunkevolve_app_server=self.webpackChunkevolve_app_server||[]).push([["4321"],{36740:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>r,toc:()=>c,default:()=>d,metadata:()=>i,assets:()=>l,contentTitle:()=>a});var i=JSON.parse('{"id":"authentication","title":"Authentication","description":"EAS\'s only method of authentication is through Microsoft EntraID (formally Microsoft Active Directory). This document covers the implementation and deployment models","source":"@site/versioned_docs/version-2.7.0/authentication.md","sourceDirName":".","slug":"/authentication","permalink":"/evolve/docs/evolve-app-server/2.7.0/authentication","draft":false,"unlisted":false,"tags":[],"version":"2.7.0","frontMatter":{"id":"authentication","title":"Authentication","slug":"/authentication"},"sidebar":"sidebar","previous":{"title":"Personal Access Tokens","permalink":"/evolve/docs/evolve-app-server/2.7.0/personal-access-tokens"}}'),s=t(74848),o=t(84429);let r={id:"authentication",title:"Authentication",slug:"/authentication"},a,l={},c=[{value:"Implementation",id:"implementation",level:2},{value:"Deployment Models",id:"deployment-models",level:2},{value:"Zepben Managed",id:"zepben-managed",level:3},{value:"Customer Managed",id:"customer-managed",level:3},{value:"Setup Process",id:"setup-process",level:4},{value:"Self-Hosted",id:"self-hosted",level:3},{value:"Setup Process",id:"setup-process-1",level:4}];function p(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"EAS's only method of authentication is through Microsoft EntraID (formally Microsoft Active Directory). This document covers the implementation and deployment models"}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.p,{children:"EAS implements the OpenID Connect (OIDC) protocol where JWT tokens issued by an IdP are validated using published JWKS keys. The frontend implements the OAuth 2.0 Authorization code flow with PKCE to login the user and the resulting JWT is sent to EAS in every request. Both the frontend and EAS leave it to  the IdP to perform any custom authentication rules such as MFA and session timeouts."}),"\n",(0,s.jsx)(n.h2,{id:"deployment-models",children:"Deployment Models"}),"\n",(0,s.jsx)(n.p,{children:"There are three deployment models, each with their own tradeoffs."}),"\n",(0,s.jsx)(n.h3,{id:"zepben-managed",children:"Zepben Managed"}),"\n",(0,s.jsx)(n.p,{children:"This deployment methodology involves Zepben setting a up a dedicated EntraID tenant for your deployment. Zepben will then configure applications to use this tenant as its authentication provider. This is a fast, low overhead way of getting your Zepben platform setup."}),"\n",(0,s.jsx)(n.p,{children:"With this deployment style:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User additions/removes/role assignemnts will be managed by Zepben support"}),"\n",(0,s.jsxs)(n.li,{children:["Users will have a separate own username and password to login, password resets will be conducted by Zepben support","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If the email addresses belong to their own EntraID tenant, then ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/external-id/what-is-b2b",children:"EntraID B2B Collaboration"})," will be used where users use the source tenant credentials to login"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Multi-factor authentication is used and resets are managed by Zepben support"}),"\n",(0,s.jsx)(n.li,{children:"There are no customizations available, eg. Geo-location rules, IP rules etc."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"customer-managed",children:"Customer Managed"}),"\n",(0,s.jsx)(n.p,{children:"This deployment methodology allow customers to bring your own EntraID tenant for authentication. Zepben will integrate our applications to allow logins from your tenant using EntraID Single Sign On (SSO)."}),"\n",(0,s.jsx)(n.p,{children:"With this deployment style:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Users additions/remove/role assignments are managed by the Customer"}),"\n",(0,s.jsx)(n.li,{children:"Customer will manage user password/MFA resets"}),"\n",(0,s.jsxs)(n.li,{children:["Custom authentication rules using ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/conditional-access/overview",children:"EntraID Conditional Access"})," can be used to control authentication requirements"]}),"\n",(0,s.jsx)(n.li,{children:"Zepben will continue to manage application configuration in our own tenant"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"setup-process",children:"Setup Process"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Customer will provide Zepben with their EntraID tenant ID"}),"\n",(0,s.jsxs)(n.li,{children:["Zepben will provision EntraID Application registrations as ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/conditional-access/overview",children:"multi tenant applications"})]}),"\n",(0,s.jsx)(n.li,{children:"Zepben will provide a set of Enterprise Application client ids to Customer"}),"\n",(0,s.jsxs)(n.li,{children:["Customer will ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/create-service-principal-cross-tenant?pivots=azure-cli",children:"add each Enterprise Application"})," to their tenant"]}),"\n",(0,s.jsxs)(n.li,{children:["Customer will grant ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/grant-admin-consent?pivots=portal",children:"admin consent"})," for all roles in each Enterprise Application"]}),"\n",(0,s.jsx)(n.li,{children:"Zepben will configure applications to trust logins from customer tenant and provide customer platform URL"}),"\n",(0,s.jsxs)(n.li,{children:["Customer can ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/assign-user-or-group-access-portal?pivots=portal",children:"assign users"})," to application roles"]}),"\n",(0,s.jsx)(n.li,{children:"Users can now login to the Zepben platform"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"self-hosted",children:"Self-Hosted"}),"\n",(0,s.jsx)(n.p,{children:"This deployment model is only applicable if you are self hosting all of EAS and EWB. This deployment model is similar to the customer managed version except with the added responsbility of managing the servers and the EntraID application registrations."}),"\n",(0,s.jsx)(n.h4,{id:"setup-process-1",children:"Setup Process"}),"\n",(0,s.jsx)(n.p,{children:"This process require setting up the EAS and EWB applications in Microsoft EntraID. The Powershell script below is an example script that can be used to achieve this."}),"\n",(0,s.jsx)(n.p,{children:"The script:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creates the EAS and EWB applications"}),"\n",(0,s.jsx)(n.li,{children:"Creates Service Principals for each applications"}),"\n",(0,s.jsx)(n.li,{children:"Sets EAS as an SPA application"}),"\n",(0,s.jsx)(n.li,{children:"Creates the roles / OAuth scopes required in each application"}),"\n",(0,s.jsx)(n.li,{children:"Grants EAS access to retrieve data from EWB"}),"\n",(0,s.jsx)(n.li,{children:"Grant both applications access to Microsoft Graph user details"}),"\n",(0,s.jsx)(n.li,{children:"Finally, prints out the JSON snippets required to configure each application"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'<#\nPrerequisites:\n - Install-Module Microsoft.Graph -Scope CurrentUser\n - You must sign in with an account that has Application.ReadWrite.All (or Global Admin) to create app registrations.\n - Run: Connect-MgGraph -Scopes "Application.ReadWrite.All","Application.Read.All","Directory.ReadWrite.All"\n#>\n\n$easDisplayName = "EAS-test6"\n$ewbDisplayName = "EWB-test6"\n\n$spaRedirectUris = @(\n  "https://your-production-app.example.com"\n)\n\n$easRoleNames = @(\n  "SUPER_ADMIN",\n  "EWB_ADMIN",\n  "TIMESERIES_MODELLER",\n  "MODELLER",\n  "DEVELOPER",\n  "MAP_VIEWER",\n  "EWB_UPDATER",\n  "METRICS_VIEWER",\n  "NETWORK_MODEL_EXECUTOR",\n  "INTEGRATION_ADMIN",\n  "EWB_CUSTOMER_VIEWER",\n  "EWB_DIAGRAM_VIEWER",\n  "CUSTOMER_PII_READ",\n  "CUSTOMER_NON_PII_READ",\n  "CUSTOMER_PII_EXPORT",\n  "CUSTOMER_NON_PII_EXPORT"\n)\n\n$ewbRoleNames = @(\n  "read:ewb",\n  "read:customer",\n  "read:diagram"\n)\n\n$msGraphAppId = "00000003-0000-0000-c000-000000000000"      # Microsoft Graph\n$userReadScopeId = "e1fe6dd8-ba31-4d61-89e7-88639da4683d"  # User.Read (delegated)\n\nWrite-Host "Connecting to Microsoft Graph. You must consent with a user who has permission to create apps..." -ForegroundColor Cyan\nConnect-MgGraph -Scopes "Application.ReadWrite.All","Directory.ReadWrite.All"\n\n$tenantId = (Get-MgContext).TenantId\n\nfunction New-GuidString { [Guid]::NewGuid().ToString() }\n\nfunction New-Roles {\n  param (\n    [Parameter(Mandatory = $true)]\n    [string[]]$Roles\n  )\n\n  $appRoles = @()\n  $oauth2PermissionScopes = @()\n\n  foreach ($r in $Roles) {\n    $roleId = New-GuidString\n\n    $appRole = @{\n        Id = $roleId\n        AllowedMemberTypes = @("User","Application")\n        DisplayName = $r\n        Description = $r\n        Value = $r\n        IsEnabled = $true\n    }\n    $appRoles += $appRole\n\n    $scope = @{\n        Id = $roleId\n        AdminConsentDisplayName = $r\n        AdminConsentDescription = $r\n        Type = "User"\n        IsEnabled = $true\n        UserConsentDisplayName = ""\n        UserConsentDescription = ""\n        Value = $r\n    }\n    $oauth2PermissionScopes += $scope\n  }\n\n  return $appRoles, $oauth2PermissionScopes\n}\n\n$requiredResourceAccess = @(\n  @{\n    ResourceAppId = $msGraphAppId\n    ResourceAccess = @(\n      @{\n          Id = $userReadScopeId\n          Type = "Scope"\n      }\n    )\n  }\n)\n\n# ====== EAS\n\nWrite-Host "Creating EAS application registration \'$easDisplayName\'..." -ForegroundColor Cyan\n\n$spaObject = @{ RedirectUris = $spaRedirectUris }\n\n$easRoles, $easOAuth = New-Roles -Roles $easRoleNames\n$easApi = @{\n  RequestedAccessTokenVersion = 2\n  Oauth2PermissionScopes = $easOAuth\n}\n\n$eas = New-MgApplication -DisplayName $easDisplayName `\n    -AppRoles $easRoles `\n    -Api $easApi `\n    -Spa $spaObject `\n    -RequiredResourceAccess $requiredResourceAccess\n\nif ($null -eq $eas) {\n    throw "Failed to create EAS application."\n}\n\nWrite-Host "Application created. appId (clientId): $($eas.AppId)" -ForegroundColor Green\nWrite-Host "Creating EAS service principal for the app..." -ForegroundColor Cyan\n\n$easSp = New-MgServicePrincipal -AppId $eas.AppId\nWrite-Host "Service principal created: objectId = $($easSp.Id)" -ForegroundColor Green\n\n# ======= EWB\n\nWrite-Host "Creating EWB application registration \'$ewbDisplayName\'..." -ForegroundColor Cyan\n\n$ewbRoles, $ewbOAuth = New-Roles -Roles $ewbRoleNames\n$ewbApi = @{\n  RequestedAccessTokenVersion = 2\n  Oauth2PermissionScopes = $ewbOAuth\n}\n\n$ewb = New-MgApplication -DisplayName $ewbDisplayName `\n    -AppRoles $ewbRoles `\n    -Api $ewbApi `\n    -RequiredResourceAccess $requiredResourceAccess\n\nif ($null -eq $ewb) {\n    throw "Failed to create EWB application."\n}\n\nWrite-Host "Application created. appId (clientId): $($ewb.AppId)" -ForegroundColor Green\nWrite-Host "Creating EAS service principal for the app..." -ForegroundColor Cyan\n\n$ewbSp = New-MgServicePrincipal -AppId $ewb.AppId\nWrite-Host "Service principal created: objectId = $($ewbSp.Id)" -ForegroundColor Green\n\n# ======= Assign roles\n\nforeach ($r in $ewbRoles) {\n  New-MgServicePrincipalAppRoleAssignment `\n    -ServicePrincipalId $easSp.Id `\n    -PrincipalId $easSp.Id `\n    -ResourceId $ewbSp.Id `\n    -AppRoleId $r.Id\n}\n\n# ======= Final Config\n\n$frontend = @{\n  authType         = "entraid"\n  domain           = "https://login.microsoftonline.com/${tenantId}/v2.0"\n  clientId         = $eas.AppId\n  audience         = $eas.AppId\n}\n\n$trustedIssuers = @(\n  "https://login.microsoftonline.com/${tenantId}/v2.0"\n) + $spaRedirectUris\n\n$easConfig = @{\n  method         = "entraid"\n  audience       = $eas.AppId\n  trustedIssuers = $trustedIssuers\n}\n\n$ewbConfig = @{\n  authType       = "entraid"\n  audience       = $ewb.AppId\n  trustedIssuers = $trustedIssuers\n}\n\nWrite-Host "EAS Frontend Config" -ForegroundColor Green\nWrite-Host (ConvertTo-Json -InputObject $frontend)\n\nWrite-Host "EAS Auth Config" -ForegroundColor Green\nWrite-Host (ConvertTo-Json -InputObject $easConfig)\n\nWrite-Host "EWB Auth Config" -ForegroundColor Green\nWrite-Host (ConvertTo-Json -InputObject $ewbConfig)\n'})}),"\n",(0,s.jsx)(n.p,{children:"The output of the above script will look something like this."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'EAS Frontend Config\n{\n  "audience": "fce16e12-2eaa-4f5c-866b-bd4d08de23ea",\n  "domain": "https://login.microsoftonline.com/d884eee1-c96f-4701-8103-2ba4346db120/v2.0",\n  "clientId": "fce16e12-2eaa-4f5c-866b-bd4d08de23ea",\n  "authType": "entraid"\n}\nEAS Auth Config\n{\n  "trustedIssuers": [\n    "https://login.microsoftonline.com/d884eee1-c96f-4701-8103-2ba4346db120/v2.0",\n    "https://your-production-app.example.com"\n  ],\n  "audience": "fce16e12-2eaa-4f5c-866b-bd4d08de23ea",\n  "method": "entraid"\n}\nEWB Auth Config\n{\n  "audience": "6744e920-f146-4049-b80f-8e17888a3f7b",\n  "trustedIssuers": [\n    "https://login.microsoftonline.com/d884eee1-c96f-4701-8103-2ba4346db120/v2.0",\n    "https://your-production-app.example.com"\n  ],\n  "authType": "entraid"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Using the above output, refer to the configuration documentation in the relevant applications to configure authentication"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zepben.github.io/evolve/docs/eas-web-client",children:"Evolve Web Server Client"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/evolve/docs/evolve-app-server/2.7.0/config",children:"Evolve App Server"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zepben.github.io/evolve/docs/energy-workbench-server/",children:"Energy Workbench Server"})}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},84429:function(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(96540);let s={},o=i.createContext(s);function r(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);