"use strict";(self.webpackChunkewb_sdk_jvm=self.webpackChunkewb_sdk_jvm||[]).push([["1773"],{11861:function(e,t,n){n.r(t),n.d(t,{metadata:()=>r,default:()=>m,frontMatter:()=>l,contentTitle:()=>c,toc:()=>d,assets:()=>u});var r=JSON.parse('{"id":"sdk-metrics","title":"Ingestion Jobs and Metrics","description":"Record-Keeping","source":"@site/versioned_docs/version-0.22.0/metrics.mdx","sourceDirName":".","slug":"/sdk-metrics","permalink":"/evolve/docs/ewb-sdk-jvm/0.22.0/sdk-metrics","draft":false,"unlisted":false,"tags":[],"version":"0.22.0","frontMatter":{"id":"sdk-metrics","title":"Ingestion Jobs and Metrics"},"sidebar":"someSidebar","previous":{"title":"Protection Relays","permalink":"/evolve/docs/ewb-sdk-jvm/0.22.0/sdk-protection"}}'),o=n(74848),a=n(28453),i=n(78010),s=n(57250);let l={id:"sdk-metrics",title:"Ingestion Jobs and Metrics"},c,u={},d=[{value:"Record-Keeping",id:"record-keeping",level:2},{value:"Ingestion Job Model",id:"ingestion-job-model",level:2}];function p(e){let t={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"record-keeping",children:"Record-Keeping"}),"\n",(0,o.jsx)(t.p,{children:"It's often useful to have a record of previous runs of a data ingestor. For this reason, the Evolve SDK supports the ability to save the following information\nabout each run:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Metadata:","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Timestamp of when the run started"}),"\n",(0,o.jsx)(t.li,{children:'A short description of the source data (e.g. "ExampleEnergy full HV/LV 2024-01-02 cut")'}),"\n",(0,o.jsx)(t.li,{children:'The name of the application used to process the source data (e.g. "example-energy-ingestor")'}),"\n",(0,o.jsx)(t.li,{children:'The version of the application used to process the source data (e.g. "0.12.0")'}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["For each data source used (e.g. files) for the run:","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:'The name of the data source (e.g. "ABC_feeder.xml")'}),"\n",(0,o.jsx)(t.li,{children:"Timestamp of when the data source was exported"}),"\n",(0,o.jsx)(t.li,{children:"The SHA-256 of the data source's contents, if applicable"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["Network container metrics:","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"A network container may either be the entire network processed in a run, or a section of the network (geographical region, subgeographical region,\nsubstation, feeder, or LV feeder)."}),"\n",(0,o.jsx)(t.li,{children:"For each network container, any number of metrics may be recorded. Each metric may have an arbitrary string name and a numeric value."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The above information is captured in an in-memory model named ",(0,o.jsx)(t.code,{children:"IngestionJob"}),". an ",(0,o.jsx)(t.code,{children:"IngestionJob"}),' with metadata may be saved to a "metrics" database using the\n',(0,o.jsx)(t.code,{children:"MetricsDatabaseWriter"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"ingestion-job-model",children:"Ingestion Job Model"}),"\n",(0,o.jsxs)(t.p,{children:["The following is an example of creating, populating, and saving an ",(0,o.jsx)(t.code,{children:"IngestionJob"})," object to a metrics database file, ",(0,o.jsx)(t.code,{children:"metrics.sqlite"}),"."]}),"\n",(0,o.jsxs)(i.A,{groupId:"code-example",defaultValue:"java",values:[{label:"Java",value:"java"},{label:"Kotlin",value:"kotlin"}],children:[(0,o.jsx)(s.A,{value:"java",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'import com.zepben.evolve.cim.iec61970.base.core.Feeder;\nimport com.zepben.evolve.database.sqlite.metrics.MetricsDatabaseWriter;\nimport com.zepben.evolve.metrics.IngestionJob;\nimport com.zepben.evolve.metrics.IngestionMetadata;\nimport com.zepben.evolve.metrics.TotalNetworkContainer;\n\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.time.Instant;\nimport java.util.UUID;\n\nimport static com.zepben.evolve.metrics.NetworkContainerKt.networkContainer;\n\npublic class IngestionJobExample {\n    public static void main(String[] args) throws NoSuchAlgorithmException {\n        MessageDigest digest = MessageDigest.getInstance("SHA-256");\n\n        // This would normally be inside a NetworkService, but it is created here for this example.\n        Feeder feeder = new Feeder("abc-feeder");\n        feeder.setName("ABC feeder");\n\n        IngestionJob ingestionJob = new IngestionJob(\n            UUID.randomUUID(),\n            new IngestionMetadata(\n                Instant.now(),\n                "ExampleEnergy full HV/LV 2024-01-02 cut",\n                "example-energy-ingestor",\n                "0.12.0"\n            )\n        );\n\n        // Sources and network metrics are "automaps", which populate default values for new keys as they are accessed.\n        ingestionJob.getSources().get("ABC_feeder.xml").setTimestamp(Instant.parse("2020-01-02T10:30:00.00Z"));\n        ingestionJob.getSources().get("ABC_feeder.xml").setFileHash(digest.digest("file contents".getBytes()));\n        ingestionJob.getNetworkMetrics().get(TotalNetworkContainer.INSTANCE).put("total cable length", 123.45);\n        ingestionJob.getNetworkMetrics().get(networkContainer(feeder)).put("total cable length", 12.345);\n        ingestionJob.getNetworkMetrics().get(networkContainer(feeder, true)).put("total cable length", 123.45);\n\n        if (new MetricsDatabaseWriter("metrics.sqlite", ingestionJob).save()) {\n            System.out.println("Ingestion job saved successfully");\n        } else {\n            System.out.println("Ingestion job could not be saved successfully");\n        }\n    }\n}\n'})})}),(0,o.jsx)(s.A,{value:"kotlin",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-kotlin",children:'import com.zepben.evolve.cim.iec61970.base.core.Feeder\nimport com.zepben.evolve.database.sqlite.metrics.MetricsDatabaseWriter\nimport com.zepben.evolve.metrics.IngestionJob\nimport com.zepben.evolve.metrics.IngestionMetadata\nimport com.zepben.evolve.metrics.TotalNetworkContainer\nimport com.zepben.evolve.metrics.toNetworkContainer\nimport java.security.MessageDigest\nimport java.time.Instant\nimport java.util.*\n\n// This would normally be inside a NetworkService, but it is created here for this example.\nval feeder = Feeder("abc-feeder").apply { name = "ABC Feeder" }\n\nval ingestionJob = IngestionJob(UUID.randomUUID()).apply {\n    metadata = IngestionMetadata(\n        startTime = Instant.now(),\n        source = "ExampleEnergy full HV/LV 2024-01-02 cut",\n        application = "example-energy-ingestor",\n        applicationVersion = "0.12.0"\n    )\n\n    // Sources and network metrics are "automaps", which populate default values for new keys as they are accessed.\n    sources["ABC_feeder.xml"].timestamp = Instant.parse("2020-01-02T10:30:00.00Z")\n    sources["ABC_feeder.xml"].fileHash = MessageDigest.getInstance("SHA-256").digest("file contents".toByteArray())\n    networkMetrics[TotalNetworkContainer]["total cable length"] = 123.45\n    networkMetrics[feeder.toNetworkContainer()]["total cable length"] = 12.345\n    networkMetrics[feeder.toNetworkContainer(includeDownstream = true)]["total cable length"] = 123.45\n}\n\nfun main() {\n    if (MetricsDatabaseWriter("metrics.sqlite", ingestionJob).save()) {\n        println("Ingestion job saved successfully")\n    } else {\n        println("Ingestion job could not be saved successfully")\n    }\n}\n'})})})]}),"\n",(0,o.jsx)(t.p,{children:"Each job in a metrics database should have a unique UUID. If you attempt to save a job to an existing database, it will be added to it rather than replacing the\nentire database."})]})}function m(e={}){let{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},57250:function(e,t,n){n.d(t,{A:()=>a});var r=n(74848);n(96540);var o=n(34164);function a(e){let{children:t,hidden:n,className:a}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)("tabItem_Ymn6",a),hidden:n,children:t})}},78010:function(e,t,n){n.d(t,{A:()=>y});var r=n(74848),o=n(96540),a=n(34164),i=n(28584),s=n(56347),l=n(99989),c=n(96629),u=n(80618),d=n(41367);function p(e){var t,n;return null!=(n=null==(t=o.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error("Docusaurus error: Bad <Tabs> child <".concat("string"==typeof e.type?e.type:e.type.name,'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.'))}))?void 0:t.filter(Boolean))?n:[]}function m(e){let{value:t,tabValues:n}=e;return n.some(e=>e.value===t)}var b=n(19863);function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function g(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:l}=e,c=[],{blockElementScrollPositionUntilNextRender:u}=(0,i.a_)(),d=e=>{let t=e.currentTarget,n=l[c.indexOf(t)].value;n!==o&&(u(t),s(n))},p=e=>{var t,n;let r=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let n=c.indexOf(e.currentTarget)+1;r=null!=(t=c[n])?t:c[0];break}case"ArrowLeft":{let t=c.indexOf(e.currentTarget)-1;r=null!=(n=c[t])?n:c[c.length-1]}}null==r||r.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},t),children:l.map(e=>{let{value:t,label:n,attributes:i}=e;return(0,r.jsx)("li",h(f({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,ref:e=>{c.push(e)},onKeyDown:p,onClick:d},i),{className:(0,a.A)("tabs__item","tabItem_LNqP",null==i?void 0:i.className,{"tabs__item--active":o===t}),children:null!=n?n:t}),t)})})}function v(e){let{lazy:t,children:n,selectedValue:i}=e,s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){let e=s.find(e=>e.props.value===i);return e?(0,o.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:s.map((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==i}))})}function j(e){let t=function(e){let t,{defaultValue:n,queryString:r=!1,groupId:a}=e,i=function(e){let{values:t,children:n}=e;return(0,o.useMemo)(()=>{let e=null!=t?t:p(n).map(e=>{let{props:{value:t,label:n,attributes:r,default:o}}=e;return{value:t,label:n,attributes:r,default:o}}),r=(0,u.XI)(e,(e,t)=>e.value===t.value);if(r.length>0)throw Error('Docusaurus error: Duplicate values "'.concat(r.map(e=>e.value).join(", "),'" found in <Tabs>. Every value needs to be unique.'));return e},[t,n])}(e),[b,f]=(0,o.useState)(()=>(function(e){var t;let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:r}))throw Error('Docusaurus error: The <Tabs> has a defaultValue "'.concat(n,'" but none of its children has the corresponding value. Available values are: ').concat(r.map(e=>e.value).join(", "),". If you intend to show no default tab, use defaultValue={null} instead."));return n}let o=null!=(t=r.find(e=>e.default))?t:r[0];if(!o)throw Error("Unexpected error: 0 tabValues");return o.value})({defaultValue:n,tabValues:i})),[h,g]=function(e){let{queryString:t=!1,groupId:n}=e,r=(0,s.W6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,c.aZ)(a),(0,o.useCallback)(e=>{var t,n;if(!a)return;let o=new URLSearchParams(r.location.search);o.set(a,e),r.replace((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},r.location),n=n={search:o.toString()},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))},[a,r])]}({queryString:r,groupId:a}),[v,j]=function(e){let{groupId:t}=e,n=t?"docusaurus.tab.".concat(t):null,[r,a]=(0,d.Dv)(n);return[r,(0,o.useCallback)(e=>{n&&a.set(e)},[n,a])]}({groupId:a}),y=m({value:t=null!=h?h:v,tabValues:i})?t:null;return(0,l.A)(()=>{y&&f(y)},[y]),{selectedValue:b,selectValue:(0,o.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw Error("Can't select invalid tab value=".concat(e));f(e),g(e),j(e)},[g,j,i]),tabValues:i}}(e);return(0,r.jsxs)("div",{className:(0,a.A)("tabs-container","tabList__CuJ"),children:[(0,r.jsx)(g,f({},t,e)),(0,r.jsx)(v,f({},t,e))]})}function y(e){let t=(0,b.A)();return(0,r.jsx)(j,h(f({},e),{children:p(e.children)}),String(t))}},28453:function(e,t,n){n.d(t,{R:()=>i,x:()=>s});var r=n(96540);let o={},a=r.createContext(o);function i(e){let t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);