"use strict";(self.webpackChunkewb_sdk_examples_python=self.webpackChunkewb_sdk_examples_python||[]).push([["7697"],{4862:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>a,toc:()=>d,default:()=>h,metadata:()=>t,assets:()=>i,contentTitle:()=>c});var t=JSON.parse('{"id":"examples-downstream-and-upstream-trace","title":"Downstream and Upstream Tracing Use Cases","description":"In this example, we demonstrate the use cases for downstream and upstream tracing within a power network. Specifically, the code performs the following two tasks:","source":"@site/docs/downstream_and_upstream_trace_use_case.mdx","sourceDirName":".","slug":"/examples-downstream-and-upstream-trace","permalink":"/evolve/docs/ewb-sdk-examples-python/next/examples-downstream-and-upstream-trace","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"examples-downstream-and-upstream-trace","title":"Downstream and Upstream Tracing Use Cases"},"sidebar":"someSidebar","previous":{"title":"Creating and Uploading Studies","permalink":"/evolve/docs/ewb-sdk-examples-python/next/examples-creating-and-uploading-studies"}}'),s=r(4848),o=r(4429);r(3021),r(2207);let a={id:"examples-downstream-and-upstream-trace",title:"Downstream and Upstream Tracing Use Cases"},c,i={},d=[{value:"Overview of the Code",id:"overview-of-the-code",level:2},{value:"Key Imports",id:"key-imports",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Code Breakdown",id:"code-breakdown",level:2},{value:"Step 1: Connect to the EWB Server",id:"step-1-connect-to-the-ewb-server",level:3},{value:"Step 2: Fetch Feeder Network",id:"step-2-fetch-feeder-network",level:3},{value:"Step 3: Perform Downstream Trace",id:"step-3-perform-downstream-trace",level:3},{value:"Step 4: Perform Upstream Trace",id:"step-4-perform-upstream-trace",level:3},{value:"Step 5: Define Trace Actions",id:"step-5-define-trace-actions",level:3},{value:"Step 6: Run the Tracing Process",id:"step-6-run-the-tracing-process",level:3},{value:"Output",id:"output",level:2},{value:"Downstream Trace",id:"downstream-trace",level:3},{value:"Upstream trace",id:"upstream-trace",level:3}];function l(e){let n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"In this example, we demonstrate the use cases for downstream and upstream tracing within a power network. Specifically, the code performs the following two tasks:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Downstream Trace"}),": For each transformer, it counts the number of Energy Consumers (ECs) downstream of it. The downstream trace calculates how many Energy Consumers are connected downstream from each transformer, and this count is printed for each transformer."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Upstream Trace"}),": For each Energy Consumer, the code calculates the upstream length from the Energy Consumer to the feeder head. This upstream trace calculates the total length of the cables (in kilometers or meters) that lead upstream from each Energy Consumer."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overview-of-the-code",children:"Overview of the Code"}),"\n",(0,s.jsxs)(n.p,{children:["The code in this example connects to a Network Consumer Client, uses ",(0,s.jsx)(n.code,{children:"normal_downstream_trace"})," to trace downstream from each ",(0,s.jsx)(n.code,{children:"PowerTransformer"}),", and uses ",(0,s.jsx)(n.code,{children:"normal_upstream_trace"})," to trace upstream from each ",(0,s.jsx)(n.code,{children:"EnergyConsumer"}),". It fetches data for the specified feeder, processes the network objects (PowerTransformers and EnergyConsumers), and performs the respective traces."]}),"\n",(0,s.jsx)(n.p,{children:"The results are printed as follows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Downstream Trace"}),": For each ",(0,s.jsx)(n.code,{children:"PowerTransformer"}),", it prints the number of ",(0,s.jsx)(n.code,{children:"EnergyConsumers"})," downstream."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Upstream Trace"}),": For each ",(0,s.jsx)(n.code,{children:"EnergyConsumer"}),", it prints the total length of the upstream cables to the feeder head."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"key-imports",children:"Key Imports"}),"\n",(0,s.jsx)(n.p,{children:"To run/test this example, ensure that you have installed the following libraries as they are used to interact with the Evolve API, perform network tracing, and work with the network equipment models."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import asyncio\nimport json\nfrom zepben.evolve import NetworkConsumerClient, PhaseStep, PhaseCode, AcLineSegment, normal_downstream_trace, connect_with_token, EnergyConsumer, PowerTransformer, normal_upstream_trace\nfrom zepben.evolve.services.network.tracing.phases.phase_step import start_at\nfrom zepben.protobuf.nc.nc_requests_pb2 import IncludedEnergizedContainers\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"config.json"})," file contains the connection details for the server. It includes the server's host address, access token, and the RPC port. Ensure that you have replaced ",(0,s.jsx)(n.code,{children:"your_server_host"}),", ",(0,s.jsx)(n.code,{children:"your_access_token"}),", and ",(0,s.jsx)(n.code,{children:"rpc_port"})," with the specific details."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "host": "your_server_host",\n  "access_token": "your_access_token",\n  "rpc_port": 1234\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"code-breakdown",children:"Code Breakdown"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-connect-to-the-ewb-server",children:"Step 1: Connect to the EWB Server"}),"\n",(0,s.jsxs)(n.p,{children:["The code first loads the connection configuration from ",(0,s.jsx)(n.code,{children:"config.json"}),", then establishes a connection to the server using ",(0,s.jsx)(n.code,{children:"connect_with_token"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'channel = connect_with_token(host=c["host"], access_token=c["access_token"], rpc_port=c["rpc_port"])\n'})}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.code,{children:"NetworkConsumerClient"})," object is created, which will be used to interact with the network data."]}),"\n",(0,s.jsx)(n.h3,{id:"step-2-fetch-feeder-network",children:"Step 2: Fetch Feeder Network"}),"\n",(0,s.jsxs)(n.p,{children:["Once connected, the code retrieves the network hierarchy of the feeders using the ",(0,s.jsx)(n.code,{children:"get_network_hierarchy"})," method:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"result = (await client.get_network_hierarchy()).throw_on_error().result\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The network data for each feeder is processed and fetched through the ",(0,s.jsx)(n.code,{children:"get_feeder_network"})," function, which includes energized LV feeders."]}),"\n",(0,s.jsx)(n.h3,{id:"step-3-perform-downstream-trace",children:"Step 3: Perform Downstream Trace"}),"\n",(0,s.jsxs)(n.p,{children:["For each ",(0,s.jsx)(n.code,{children:"PowerTransformer"}),", the downstream trace is performed using ",(0,s.jsx)(n.code,{children:"normal_downstream_trace"}),". The ",(0,s.jsx)(n.code,{children:"get_downstream_customer_count"})," function is called for each ",(0,s.jsx)(n.code,{children:"PowerTransformer"})," to determine the number of ",(0,s.jsx)(n.code,{children:"EnergyConsumers"})," downstream:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'for io in network.objects(PowerTransformer):\n    customers = await get_downstream_customer_count(start_at(io, PhaseCode.ABCN))\n    print(f"Transformer {io.mrid} has {customers} Energy Consumer(s)")\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Here, ",(0,s.jsx)(n.code,{children:"start_at(io, PhaseCode.ABCN)"})," indicates that the trace starts from the ",(0,s.jsx)(n.code,{children:"PowerTransformer"})," ",(0,s.jsx)(n.code,{children:"io"}),", using the ",(0,s.jsx)(n.code,{children:"ABCN"})," phase configuration."]}),"\n",(0,s.jsx)(n.h3,{id:"step-4-perform-upstream-trace",children:"Step 4: Perform Upstream Trace"}),"\n",(0,s.jsxs)(n.p,{children:["For each ",(0,s.jsx)(n.code,{children:"EnergyConsumer"}),", the upstream trace is performed using ",(0,s.jsx)(n.code,{children:"normal_upstream_trace"}),". The ",(0,s.jsx)(n.code,{children:"get_upstream_length"})," function calculates the total upstream length for each ",(0,s.jsx)(n.code,{children:"EnergyConsumer"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'for ec in network.objects(EnergyConsumer):\n    upstream_length = await get_upstream_length(start_at(ec, PhaseCode.ABCN))\n    print(f"Energy Consumer {ec.mrid} --\x3e Upstream Length: {upstream_length}")\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The upstream length is calculated by adding up the length of each ",(0,s.jsx)(n.code,{children:"AcLineSegment"})," that leads upstream from the ",(0,s.jsx)(n.code,{children:"EnergyConsumer"})," until the feeder head is reached."]}),"\n",(0,s.jsx)(n.h3,{id:"step-5-define-trace-actions",children:"Step 5: Define Trace Actions"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"get_downstream_customer_count"})," and ",(0,s.jsx)(n.code,{children:"get_upstream_length"})," functions use trace action definitions to perform the downstream and upstream traces."]}),"\n",(0,s.jsx)(n.p,{children:"For downstream tracing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"async def get_downstream_customer_count(ce: PhaseStep) -> int:\n    trace = normal_downstream_trace()\n    customer_count = 0\n\n    def collect_eq_in():\n        async def add_eq(ps, _):\n            nonlocal customer_count\n            if isinstance(ps.conducting_equipment, EnergyConsumer):\n                customer_count += 1\n        return add_eq\n\n    trace.add_step_action(collect_eq_in())\n    await trace.run(ce)\n    return customer_count\n"})}),"\n",(0,s.jsx)(n.p,{children:"For upstream tracing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"async def get_upstream_length(ce: PhaseStep) -> int:\n    trace = normal_upstream_trace()\n    upstream_length = 0\n\n    def collect_eq_in():\n        async def add_eq(ps, _):\n            nonlocal upstream_length\n            if isinstance(ps.conducting_equipment, AcLineSegment):\n                if ps.conducting_equipment.length is not None:\n                    upstream_length = upstream_length + ps.conducting_equipment.length\n        return add_eq\n\n    trace.add_step_action(collect_eq_in())\n    await trace.run(ce)\n    return upstream_length\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-6-run-the-tracing-process",children:"Step 6: Run the Tracing Process"}),"\n",(0,s.jsxs)(n.p,{children:["Finally, the main function runs the process using ",(0,s.jsx)(n.code,{children:"asyncio"}),". It processes the specified feeder, performs downstream traces for ",(0,s.jsx)(n.code,{children:"PowerTransformers"}),", and upstream traces for ",(0,s.jsx)(n.code,{children:"EnergyConsumers"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'if __name__ == "__main__":\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(main())\n'})}),"\n",(0,s.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,s.jsx)(n.h3,{id:"downstream-trace",children:"Downstream Trace"}),"\n",(0,s.jsxs)(n.p,{children:["The following is a sample output for the downstream trace.\n",(0,s.jsx)(n.img,{src:r(7818).A+"",width:"1117",height:"211"})]}),"\n",(0,s.jsx)(n.h3,{id:"upstream-trace",children:"Upstream trace"}),"\n",(0,s.jsxs)(n.p,{children:["The following is a sample output for the upstream trace.\n",(0,s.jsx)(n.img,{src:r(389).A+"",width:"1062",height:"287"})]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},7818:function(e,n,r){r.d(n,{A:()=>t});let t=r.p+"assets/images/downstream-b678463307fc24a51eb46e5c7c6db2be.png"},389:function(e,n,r){r.d(n,{A:()=>t});let t=r.p+"assets/images/upstream-bf3e4086619bb27530f66d746b0c41db.png"},2207:function(e,n,r){r(4848),r(6540)},3021:function(e,n,r){r(4848),r(6540),r(8864)},4429:function(e,n,r){r.d(n,{R:()=>a,x:()=>c});var t=r(6540);let s={},o=t.createContext(s);function a(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);