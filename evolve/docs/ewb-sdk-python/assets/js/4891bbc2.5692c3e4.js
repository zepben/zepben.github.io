"use strict";(self.webpackChunkewb_sdk_python=self.webpackChunkewb_sdk_python||[]).push([["455"],{36949:function(e,t,r){r.r(t),r.d(t,{metadata:()=>n,default:()=>p,frontMatter:()=>i,contentTitle:()=>o,toc:()=>l,assets:()=>c});var n=JSON.parse('{"id":"update-network-state-service","title":"Update Network State Service","description":"An implementation of the UpdateNetworkStateService will provide an object-oriented wrapper for the gRPC library, with the ability to update information about","source":"@site/versioned_docs/version-0.46.0/update-network-state-service.mdx","sourceDirName":".","slug":"/update-network-state-service","permalink":"/evolve/docs/ewb-sdk-python/0.46.0/update-network-state-service","draft":false,"unlisted":false,"tags":[],"version":"0.46.0","frontMatter":{"id":"update-network-state-service","title":"Update Network State Service"},"sidebar":"someSidebar","previous":{"title":"Update Network State Client","permalink":"/evolve/docs/ewb-sdk-python/0.46.0/update-network-state-client"}}'),s=r(74848),a=r(28453);r(32614),r(19314);let i={id:"update-network-state-service",title:"Update Network State Service"},o,c={},l=[{value:"Creating callbacks",id:"creating-callbacks",level:2},{value:"on_set_current_states",id:"on_set_current_states",level:3},{value:"Registering callbacks",id:"registering-callbacks",level:2},{value:"Registering the service",id:"registering-the-service",level:2},{value:"Putting it all together",id:"putting-it-all-together",level:2}];function d(e){let t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["An implementation of the ",(0,s.jsx)(t.code,{children:"UpdateNetworkStateService"})," will provide an object-oriented wrapper for the gRPC library, with the ability to update information about\nthe state of the network. This is done with the following 3 steps:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Create callbacks which will be called when gRPC messages are received from a client."}),"\n",(0,s.jsxs)(t.li,{children:["Register the callbacks with an instance of the ",(0,s.jsx)(t.code,{children:"UpdateNetworkStateService"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Add your ",(0,s.jsx)(t.code,{children:"UpdateNetworkStateService"})," instance as a gRPC service."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"creating-callbacks",children:"Creating callbacks"}),"\n",(0,s.jsxs)(t.p,{children:["Each supported message in ",(0,s.jsx)(t.code,{children:"UpdateNetworkStateService"})," requires a callback, which will be triggered when any client messages are received."]}),"\n",(0,s.jsx)(t.h3,{id:"on_set_current_states",children:"on_set_current_states"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"on_set_current_states"})," callback is triggered for each request passing in a batch of current state events, and should return a\n",(0,s.jsx)(t.a,{href:"/evolve/docs/ewb-sdk-python/0.46.0/update-network-state-client#batch-result-responses",children:"batch result response"})," to reflect the success or failure of the update process."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"from typing import AsyncGenerator, Tuple\n\nfrom zepben.evolve import CurrentStateEvent, SetCurrentStatesStatus\n\n\nasync def on_set_current_states(batches: AsyncGenerator[Tuple[int, Tuple[CurrentStateEvent, ...]], None]) -> AsyncGenerator[\n    SetCurrentStatesStatus, None]:\n    async for batch_id, events in batches:\n        # process updating of events here and return a batch result response\n"})}),"\n",(0,s.jsx)(t.h2,{id:"registering-callbacks",children:"Registering callbacks"}),"\n",(0,s.jsxs)(t.p,{children:["Registering the callbacks with the service is as simple as passing them into the ",(0,s.jsx)(t.code,{children:"UpdateNetworkStateService"})," constructor."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"service = UpdateNetworkStateService(on_set_current_states)\n"})}),"\n",(0,s.jsx)(t.h2,{id:"registering-the-service",children:"Registering the service"}),"\n",(0,s.jsx)(t.p,{children:"For the above code to have any effect, you need to register the service with a gRPC server. Once this has been done, you should start to receive callbacks for\neach request sent from a gRPC client."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"import grpc\nfrom zepben.protobuf.ns.network_state_pb2_grpc import add_UpdateNetworkStateServiceServicer_to_server\n\nfrom zepben.evolve import UpdateNetworkStateService\n\nserver = grpc.aio.server()\nhost = 'localhost:50051'\nserver.add_insecure_port(host)\n\nadd_UpdateNetworkStateServiceServicer_to_server(service, server)\n\nawait server.start()\n"})}),"\n",(0,s.jsx)(t.h2,{id:"putting-it-all-together",children:"Putting it all together"}),"\n",(0,s.jsx)(t.p,{children:"Putting each of the steps above together, you can build the scaffold of a working application"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"from typing import AsyncGenerator, Tuple\n\nimport grpc\nfrom zepben.protobuf.ns.network_state_pb2_grpc import add_UpdateNetworkStateServiceServicer_to_server\n\nfrom zepben.evolve import CurrentStateEvent, SetCurrentStatesStatus, UpdateNetworkStateService, BatchSuccessful\n\n\nclass UpdateNetworkStateServiceImpl:\n    def __init__(self):\n        self.service = UpdateNetworkStateService(self.on_set_current_states)\n\n    async def on_set_current_states(self, batches: AsyncGenerator[Tuple[int, Tuple[CurrentStateEvent, ...]], None]) -> AsyncGenerator[\n        SetCurrentStatesStatus, None]:\n        async for batch_id, events in batches:\n            # process updating of events here and return a batch result response\n\nasync def main():\n    server = grpc.aio.server()\n    host = 'localhost:50051'\n    server.add_insecure_port(host)\n\n    service = UpdateNetworkStateServiceImpl().service\n    add_UpdateNetworkStateServiceServicer_to_server(service, server)\n\n    await server.start()\n"})})]})}function p(e={}){let{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},19314:function(e,t,r){r(74848),r(96540)},32614:function(e,t,r){r(74848),r(96540),r(19863)},28453:function(e,t,r){r.d(t,{R:()=>i,x:()=>o});var n=r(96540);let s={},a=n.createContext(s);function i(e){let t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);